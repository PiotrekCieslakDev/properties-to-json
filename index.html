<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Properties ‚Üí JSON</title>
    <style>
        :root {
            --bg: #0f172a;
            --bg-accent: radial-gradient(circle at top left, #1d4ed8 0, transparent 50%),
            radial-gradient(circle at bottom right, #22c55e 0, transparent 55%),
            #020617;
            --card-bg: rgba(15, 23, 42, 0.96);
            --card-border: rgba(148, 163, 184, 0.3);
            --text: #e5e7eb;
            --muted: #9ca3af;
            --textarea-bg: #020617;
            --textarea-border: #1f2937;
            --button-primary: #4f46e5;
            --button-primary-hover: #6366f1;
            --button-secondary: transparent;
            --button-secondary-border: #4b5563;
            --chip-bg: rgba(15, 118, 110, 0.15);
            --chip-border: rgba(34, 211, 238, 0.4);
            --chip-text: #67e8f9;
            --shadow-soft: 0 28px 70px rgba(15, 23, 42, 0.95);
        }

        body.light {
            --bg: #e5e7eb;
            --bg-accent: radial-gradient(circle at top left, #bfdbfe 0, transparent 50%),
            radial-gradient(circle at bottom right, #bbf7d0 0, transparent 55%),
            #e5e7eb;
            --card-bg: #ffffff;
            --card-border: rgba(148, 163, 184, 0.6);
            --text: #020617;
            --muted: #6b7280;
            --textarea-bg: #f9fafb;
            --textarea-border: #d1d5db;
            --button-primary: #2563eb;
            --button-primary-hover: #1d4ed8;
            --button-secondary: #f3f4f6;
            --button-secondary-border: #d1d5db;
            --chip-bg: rgba(59, 130, 246, 0.08);
            --chip-border: rgba(59, 130, 246, 0.3);
            --chip-text: #1d4ed8;
            --shadow-soft: 0 26px 60px rgba(15, 23, 42, 0.18);
        }

        * {
            box-sizing: border-box;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
            "Segoe UI", sans-serif;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: stretch;
            justify-content: center;
            background: var(--bg-accent);
            color: var(--text);
            transition: background 0.4s ease, color 0.25s ease;
            padding: 32px;
        }

        @media (max-width: 768px) {
            body {
                padding: 16px;
            }
        }

        .card {
            width: 100%;
            max-width: 1400px;
            background: var(--card-bg);
            border-radius: 28px;
            padding: 30px 32px 24px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(18px);
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 1200px) {
            .card {
                padding: 36px 40px 28px;
            }
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }

        .title-block h1 {
            margin: 0;
            font-size: 26px;
            letter-spacing: -0.03em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .title-block h1 span.icon {
            font-size: 24px;
            opacity: 0.9;
        }

        .title-block p {
            margin: 6px 0 0;
            font-size: 14px;
            color: var(--muted);
        }

        .chip-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 12px;
            color: var(--muted);
            flex-wrap: wrap;
        }

        .chip {
            padding: 3px 10px;
            border-radius: 999px;
            background: var(--chip-bg);
            border: 1px solid var(--chip-border);
            color: var(--chip-text);
            font-size: 11px;
            white-space: nowrap;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle span {
            font-size: 13px;
            color: var(--muted);
        }

        .theme-button {
            position: relative;
            width: 64px;
            height: 34px;
            border-radius: 999px;
            border: 1px solid var(--textarea-border);
            background: rgba(15, 23, 42, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 4px;
            justify-content: flex-start;
            transition: background 0.2s ease, border 0.2s ease;
        }

        body.light .theme-button {
            background: #f3f4f6;
        }

        .theme-thumb {
            width: 26px;
            height: 26px;
            border-radius: 999px;
            background: #facc15;
            box-shadow: 0 4px 10px rgba(15, 23, 42, 0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: transform 0.25s ease, background 0.25s ease;
        }

        body.light .theme-thumb {
            transform: translateX(26px);
            background: #111827;
            color: #f9fafb;
        }

        .layout {
            display: grid;
            gap: 22px;
            margin-top: 14px;
            flex: 1;
            min-height: 0;
        }

        @media (min-width: 1000px) {
            .layout {
                grid-template-columns: 1fr 1fr;
            }
        }

        .field-label {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .field-label span.right {
            font-size: 12px;
        }

        .field-label code {
            font-size: 11px;
            opacity: 0.85;
        }

        textarea {
            width: 100%;
            min-height: 420px;
            padding: 12px 14px;
            border-radius: 16px;
            border: 1px solid var(--textarea-border);
            background: var(--textarea-bg);
            color: var(--text);
            font-size: 14px;
            line-height: 1.5;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
            "Liberation Mono", "Courier New", monospace;
            resize: vertical;
            outline: none;
            transition:
                    background 0.25s ease,
                    color 0.25s ease,
                    border 0.25s ease,
                    box-shadow 0.25s ease;
        }

        @media (min-width: 1200px) {
            textarea {
                min-height: 480px;
            }
        }

        textarea:focus {
            border-color: var(--button-primary);
            box-shadow: 0 0 0 1px var(--button-primary-hover);
        }

        .buttons-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 18px;
            align-items: center;
            justify-content: space-between;
        }

        .buttons-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn {
            border-radius: 999px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition:
                    background 0.18s ease,
                    transform 0.12s ease,
                    box-shadow 0.18s ease,
                    border-color 0.18s ease;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--button-primary);
            color: #f9fafb;
            box-shadow: 0 14px 32px rgba(79, 70, 229, 0.5);
        }

        .btn-primary:hover {
            background: var(--button-primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 18px 38px rgba(79, 70, 229, 0.6);
        }

        .btn-secondary {
            background: var(--button-secondary);
            border: 1px solid var(--button-secondary-border);
            color: var(--muted);
            box-shadow: 0 12px 28px rgba(15, 23, 42, 0.5);
        }

        .btn-secondary:hover {
            border-color: var(--button-primary);
            color: var(--text);
            transform: translateY(-1px);
            box-shadow: 0 16px 34px rgba(15, 23, 42, 0.7);
        }

        .btn span.icon {
            font-size: 16px;
        }

        .hint {
            font-size: 13px;
            color: var(--muted);
        }

        .message {
            font-size: 13px;
            margin-top: 10px;
            color: #22c55e;
            min-height: 18px;
            opacity: 0;
            transform: translateY(4px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        body.light .message {
            color: #16a34a;
        }

        .message.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .footer {
            margin-top: 16px;
            font-size: 12px;
            color: var(--muted);
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .footer code {
            font-size: 12px;
            opacity: 0.9;
        }
    </style>
</head>
<body class="light">
<div class="card">
    <div class="card-header">
        <div class="title-block">
            <h1>
                <span class="icon">üß©</span>
                Properties ‚Üí JSON
            </h1>
            <p>Paste your <code>.properties</code> on the left, get clean JSON on the right. Comments and profiles are stripped.</p>
            <div class="chip-row">
                <div class="chip">Live preview</div>
                <div class="chip">No backend</div>
                <span>Skips <code>#comments</code> and <code>spring.profiles.active</code></span>
            </div>
        </div>
        <div class="theme-toggle">
            <span>Theme</span>
            <button id="themeToggle" class="theme-button" type="button">
                <div class="theme-thumb" id="themeThumb">‚òÄÔ∏è</div>
            </button>
        </div>
    </div>

    <div class="layout">
        <div>
            <div class="field-label">
                <span>Input</span>
                <span class="right">Format: <code>key=value</code> or <code>key: value</code></span>
            </div>
            <textarea
                    id="propsInput"
                    placeholder="spring.profiles.active=prod
#comment
jwt-access-expiration-ms=900000
jwt-refresh-expiration-ms=604800000"></textarea>
        </div>

        <div>
            <div class="field-label">
                <span>Output</span>
                <span class="right">Read-only JSON</span>
            </div>
            <textarea id="output" readonly></textarea>
        </div>
    </div>

    <div class="buttons-row">
        <div class="buttons-group">
            <button id="convertBtn" class="btn btn-primary" type="button">
                <span class="icon">‚öôÔ∏è</span>
                <span>Convert</span>
            </button>
            <button id="copyBtn" class="btn btn-secondary" type="button">
                <span class="icon">üìã</span>
                <span>Copy JSON</span>
            </button>
            <button id="downloadBtn" class="btn btn-secondary" type="button">
                <span class="icon">‚¨áÔ∏è</span>
                <span>Download JSON</span>
            </button>
        </div>
        <div class="hint">
            Live preview: JSON updates automatically as you type.
        </div>
    </div>

    <div id="message" class="message"></div>

    <div class="footer">
        <span>Tip: you can safely paste entire <code>application.properties</code> files.</span>
    </div>
</div>

<script>
    // === Algorithm translated from Python ===
    function propertiesToJson(propertiesText) {
        const result = {};
        const lines = propertiesText.split(/\r?\n/);

        for (let line of lines) {
            line = line.trim();

            // Skip empty lines, comments, and spring.profiles.active
            if (!line || line.startsWith("#") || line.startsWith("spring.profiles.active")) {
                continue;
            }

            let key, value;

            // Support "=" and ":"
            if (line.includes("=")) {
                [key, value] = line.split("=", 2);
            } else if (line.includes(":")) {
                [key, value] = line.split(":", 2);
            } else {
                continue;
            }

            key = key.trim();
            value = value.trim();

            // Remove surrounding quotes if present
            if (
                (value.startsWith('"') && value.endsWith('"')) ||
                (value.startsWith("'") && value.endsWith("'"))
            ) {
                value = value.substring(1, value.length - 1);
            }

            result[key] = value;
        }

        return JSON.stringify(result, null, 2);
    }

    const convertBtn = document.getElementById("convertBtn");
    const copyBtn = document.getElementById("copyBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const outputEl = document.getElementById("output");
    const inputEl = document.getElementById("propsInput");
    const messageEl = document.getElementById("message");
    const body = document.body;
    const themeToggle = document.getElementById("themeToggle");
    const themeThumb = document.getElementById("themeThumb");

    function showMessage(text) {
        messageEl.textContent = text;
        if (!text) {
            messageEl.classList.remove("visible");
            return;
        }
        messageEl.classList.add("visible");
        setTimeout(() => {
            messageEl.classList.remove("visible");
        }, 2000);
    }

    function runConversion() {
        const input = inputEl.value;
        const json = propertiesToJson(input);
        outputEl.value = json;
    }

    // Convert button
    convertBtn.addEventListener("click", () => {
        runConversion();
        showMessage("Converted to JSON.");
    });

    // Live preview (debounced)
    let livePreviewTimeout = null;
    inputEl.addEventListener("input", () => {
        if (livePreviewTimeout) {
            clearTimeout(livePreviewTimeout);
        }
        livePreviewTimeout = setTimeout(() => {
            runConversion();
        }, 180);
    });

    // Copy JSON
    copyBtn.addEventListener("click", async () => {
        const text = outputEl.value.trim();
        if (!text) {
            showMessage("Nothing to copy ‚Äì output is empty.");
            return;
        }

        try {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                await navigator.clipboard.writeText(text);
            } else {
                outputEl.select();
                document.execCommand("copy");
                outputEl.setSelectionRange(0, 0);
            }
            showMessage("JSON copied to clipboard.");
        } catch (e) {
            console.error(e);
            showMessage("Failed to copy JSON.");
        }
    });

    // Download JSON
    downloadBtn.addEventListener("click", () => {
        const text = outputEl.value.trim();
        if (!text) {
            showMessage("Nothing to download ‚Äì output is empty.");
            return;
        }

        const blob = new Blob([text], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "output.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showMessage("JSON file downloaded.");
    });

    // Theme handling
    function applyTheme(theme) {
        if (theme === "dark") {
            body.classList.remove("light");
            body.classList.add("dark");
            themeThumb.textContent = "üåô";
        } else {
            body.classList.remove("dark");
            body.classList.add("light");
            themeThumb.textContent = "‚òÄÔ∏è";
        }
    }

    themeToggle.addEventListener("click", () => {
        const isDark = body.classList.contains("dark");
        const newTheme = isDark ? "light" : "dark";
        applyTheme(newTheme);
        localStorage.setItem("theme", newTheme);
    });

    const savedTheme = localStorage.getItem("theme");
    applyTheme(savedTheme || "light");

    // Initial conversion from placeholder
    runConversion();
</script>
</body>
</html>
